<!DOCTYPE html>
<html lang="en">
<head>
<!-- Azure Application Insights -->
<script type="text/javascript">
!function(T,l,y){var S=T.location,k="script",D="instrumentationKey",C="ingestionendpoint",I="disableExceptionTracking",E="ai.device.",b="toLowerCase",w="crossOrigin",N="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"5",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[b](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,u,p,l;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][b]()]=i[1])}if(!e[C]){var r=e.endpointsuffix,o=r?e.location:null;e[C]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[D]||d[D]||"",u=s[C],p=u?u+"/v2/track":d.endpointUrl,(l=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=p,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\./g,"-"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),l.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\"/g,"")+'"',o.properties={endpoint:a},i}(0,0,t,p)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:N,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(N,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(l,p))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(k);n.src=h;var e=y[w];return!e&&""!==e||"undefined"==n[w]||(n[w]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(k)[0].parentNode.appendChild(e)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[I]&&!0!==s[I]){var c="onerror";t(["_"+c]);var u=T[c];T[c]=function(e,t,n,a,i){var r=u&&u(e,t,n,a,i);return!0!==r&&m["_"+c]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);function a(){y.onInit&&y.onInit(n)}(T[t]=n).queue&&0===n.queue.length?(n.queue.push(a),n.trackPageView({})):a()}(window,document,{
src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js",
crossOrigin: "anonymous",
cfg: {
connectionString: "InstrumentationKey=104926d6-679a-4baa-919e-665bea6facac;IngestionEndpoint=https://eastus-8.in.applicationinsights.azure.com/;LiveEndpoint=https://eastus.livediagnostics.monitor.azure.com/;ApplicationId=2e7de093-fa39-4859-a48b-515db3520828"
}
});
</script>
<!-- End Application Insights -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Planner - Cleansheet Platform</title>
    <link rel="icon" type="image/png" href="assets/high-resolution-logo-files/white-on-transparent.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;600&family=Questrial&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* Cleansheet Design System - Corporate Professional */
        :root {
            /* Brand Colors */
            --color-primary-blue: #0066CC;
            --color-accent-blue: #004C99;
            --color-dark: #1a1a1a;

            /* Neutral Colors */
            --color-neutral-text: #333333;
            --color-neutral-text-light: #666666;
            --color-neutral-text-muted: #999999;
            --color-neutral-background: #f5f5f7;
            --color-neutral-background-secondary: #f8f8f8;
            --color-neutral-border: #e5e5e7;
            --color-neutral-white: #ffffff;

            /* Typography */
            --font-family-ui: 'Questrial', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-family-body: 'Barlow', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-h1: clamp(28px, 4vw, 32px);
            --font-size-h2: clamp(24px, 3.5vw, 28px);
            --font-size-h3: clamp(18px, 3vw, 20px);
            --font-size-body: clamp(14px, 2.5vw, 16px);
            --font-size-small: clamp(12px, 2.2vw, 14px);

            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 20px;
            --spacing-xxl: 24px;
            --spacing-xxxl: 32px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-body);
            font-weight: 300;
            background: var(--color-neutral-background);
            color: var(--color-neutral-text);
            line-height: 1.6;
            padding-top: 70px;
        }

        /* Header */
        header {
            background: var(--color-dark);
            color: var(--color-neutral-white);
            padding: var(--spacing-xl) var(--spacing-xxl);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-xl);
        }

        .header-text h1 {
            font-family: var(--font-family-ui);
            font-size: var(--font-size-h1);
            color: #e0e0e0;
            margin: 0;
        }

        .header-text p {
            font-size: var(--font-size-small);
            color: rgba(255, 255, 255, 0.8);
            margin-top: 4px;
        }

        .header-logo {
            height: 50px;
            width: auto;
        }

        /* Floating Home Button */
        .floating-home-btn {
            position: fixed;
            top: 16px;
            left: 16px;
            padding: 8px 16px;
            background: rgba(26, 26, 26, 0.85);
            backdrop-filter: blur(10px);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-family: var(--font-family-ui);
            font-size: 12px;
            font-weight: 600;
            z-index: 1001;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .floating-home-btn:hover {
            background: rgba(0, 102, 204, 0.95);
        }

        /* Main Content */
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-xxxl) var(--spacing-xxl);
        }

        /* Project Name Section */
        .project-name-section {
            background: white;
            padding: var(--spacing-xl);
            border-radius: 12px;
            margin-bottom: var(--spacing-xxl);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .project-name-section label {
            font-family: var(--font-family-ui);
            font-size: 14px;
            font-weight: 600;
            color: var(--color-neutral-text);
            white-space: nowrap;
        }

        .project-name-input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid var(--color-neutral-border);
            border-radius: 8px;
            font-family: var(--font-family-ui);
            font-size: 18px;
            font-weight: 600;
            color: var(--color-dark);
            transition: all 0.2s;
        }

        .project-name-input:focus {
            outline: none;
            border-color: var(--color-primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .project-name-input::placeholder {
            color: var(--color-neutral-text-muted);
            font-weight: 400;
        }

        /* Toolbar */
        .toolbar {
            background: white;
            padding: var(--spacing-xl);
            border-radius: 12px;
            margin-bottom: var(--spacing-xxl);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            align-items: center;
            justify-content: space-between;
        }

        .toolbar-left {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .toolbar-right {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-family: var(--font-family-ui);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--color-primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #0052a3;
            box-shadow: 0 2px 8px rgba(0, 102, 204, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--color-neutral-text);
            border: 1px solid var(--color-neutral-border);
        }

        .btn-secondary:hover {
            background: var(--color-neutral-background);
            border-color: var(--color-primary-blue);
        }

        .btn-toggle {
            background: white;
            color: var(--color-neutral-text);
            border: 1px solid var(--color-neutral-border);
        }

        .btn-toggle.active {
            background: var(--color-primary-blue);
            color: white;
            border-color: var(--color-primary-blue);
        }

        .btn-toggle:hover {
            border-color: var(--color-primary-blue);
        }

        .btn-toggle.active:hover {
            background: #0052a3;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }

        /* Examples Panel */
        .examples-panel {
            background: white;
            border-radius: 12px;
            padding: var(--spacing-xxl);
            margin-bottom: var(--spacing-xxl);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid var(--color-primary-blue);
        }

        .examples-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .examples-header h3 {
            font-family: var(--font-family-ui);
            font-size: var(--font-size-h3);
            color: var(--color-neutral-text);
            margin-bottom: var(--spacing-sm);
        }

        .examples-header p {
            color: var(--color-neutral-text-light);
            font-size: var(--font-size-small);
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        .example-card {
            background: var(--color-neutral-background);
            border: 2px solid var(--color-neutral-border);
            border-radius: 12px;
            padding: var(--spacing-xxl);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .example-card:hover {
            border-color: var(--color-primary-blue);
            background: white;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 102, 204, 0.15);
        }

        .example-card i {
            font-size: 48px;
            color: var(--color-primary-blue);
            margin-bottom: var(--spacing-md);
        }

        .example-card h4 {
            font-family: var(--font-family-ui);
            font-size: var(--font-size-body);
            font-weight: 600;
            color: var(--color-neutral-text);
            margin-bottom: var(--spacing-sm);
        }

        .example-card p {
            font-size: var(--font-size-small);
            color: var(--color-neutral-text-light);
            line-height: 1.5;
        }

        /* RACI Legend */
        .raci-legend {
            background: white;
            border-radius: 12px;
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xxl);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-md);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .legend-text {
            font-size: 13px;
            color: var(--color-neutral-text);
        }

        .legend-text strong {
            font-weight: 600;
            font-family: var(--font-family-ui);
        }

        /* Table Container */
        .table-container {
            background: white;
            border-radius: 12px;
            padding: var(--spacing-xxl);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        /* RACI Table */
        .raci-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .raci-table th,
        .raci-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid var(--color-neutral-border);
        }

        .raci-table th {
            background: var(--color-neutral-background);
            font-family: var(--font-family-ui);
            font-weight: 600;
            color: var(--color-neutral-text);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .raci-table th.tooltip-header {
            position: relative;
        }

        .raci-table tbody tr.task-row:hover {
            background: var(--color-neutral-background-secondary);
        }

        /* Phase Rows */
        .phase-row {
            background: var(--color-neutral-background);
        }

        .phase-row:hover {
            background: var(--color-neutral-background);
        }

        .phase-cell {
            padding: 0 !important;
            border-left: 4px solid var(--color-primary-blue);
            background: var(--color-neutral-background);
        }

        .phase-cell.unassigned {
            border-left-color: #f59e0b;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-lg);
            font-family: var(--font-family-ui);
            font-weight: 600;
            font-size: 15px;
            color: var(--color-neutral-text);
        }

        .phase-collapse-btn {
            padding: 4px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--color-primary-blue);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .phase-collapse-btn:hover {
            background: rgba(0, 102, 204, 0.1);
        }

        .phase-name-input {
            flex: 1;
            border: none;
            background: transparent;
            font-family: var(--font-family-ui);
            font-weight: 600;
            font-size: 15px;
            color: var(--color-neutral-text);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .phase-name-input:hover {
            background: white;
        }

        .phase-name-input:focus {
            outline: 2px solid var(--color-primary-blue);
            background: white;
        }

        .phase-actions {
            display: flex;
            gap: var(--spacing-sm);
            margin-left: auto;
        }

        .phase-action-btn {
            padding: 6px;
            background: white;
            border: 1px solid var(--color-neutral-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--color-neutral-text);
        }

        .phase-action-btn:hover {
            background: var(--color-primary-blue);
            color: white;
            border-color: var(--color-primary-blue);
        }

        .phase-action-btn.delete:hover {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }

        /* Phase Select - Compact Icon Version */
        .phase-selector-wrapper {
            position: relative;
            display: inline-block;
        }

        .phase-selector-btn {
            padding: 6px;
            background: white;
            border: 1px solid var(--color-neutral-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--color-neutral-text-light);
            width: 32px;
            height: 32px;
        }

        .phase-selector-btn:hover {
            background: var(--color-neutral-background);
            border-color: var(--color-primary-blue);
            color: var(--color-primary-blue);
        }

        .phase-selector-btn.has-phase {
            color: var(--color-primary-blue);
            border-color: var(--color-primary-blue);
        }

        .phase-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 4px);
            right: 0;
            background: white;
            border: 1px solid var(--color-neutral-border);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px;
            z-index: 1000;
            min-width: 200px;
            max-height: 300px;
            overflow-y: auto;
        }

        .phase-dropdown.show {
            display: block;
        }

        .phase-option {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            font-family: var(--font-family-body);
            font-size: 13px;
            color: var(--color-neutral-text);
            transition: all 0.2s;
            white-space: nowrap;
        }

        .phase-option:hover {
            background: var(--color-neutral-background);
            color: var(--color-primary-blue);
        }

        .phase-option.selected {
            background: #e3f2fd;
            color: var(--color-primary-blue);
            font-weight: 600;
        }

        .phase-option.none {
            color: var(--color-neutral-text-muted);
            font-style: italic;
        }

        /* Ensure task name input takes available space */
        .task-cell .task-input-container {
            display: flex;
            gap: 4px;
            align-items: center;
            width: 100%;
        }

        .task-cell .task-input-container input[type="text"] {
            flex: 1;
            min-width: 200px;
        }

        .raci-table td.task-cell {
            font-weight: 400;
            min-width: 200px;
        }

        /* Drag and Drop */
        .task-row {
            cursor: move;
            transition: opacity 0.2s, background 0.2s;
        }

        .task-row.dragging {
            opacity: 0.5;
        }

        .task-row.drag-over {
            background: #e3f2fd !important;
            border-top: 2px solid var(--color-primary-blue);
        }

        .drag-handle {
            cursor: grab;
            color: var(--color-neutral-text-muted);
            font-size: 18px;
            padding: 0 8px;
            display: inline-flex;
            align-items: center;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .task-row:hover .drag-handle {
            color: var(--color-primary-blue);
        }

        .raci-table td.role-cell {
            text-align: center;
            min-width: 120px;
            font-family: var(--font-family-ui);
        }

        .raci-table td.actions-cell {
            text-align: center;
            white-space: nowrap;
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: center;
        }

        /* Hide role columns when roles are not visible */
        .raci-table.hide-roles .role-header,
        .raci-table.hide-roles .role-cell {
            display: none;
        }

        /* Editable cells */
        .editable {
            cursor: text;
            position: relative;
        }

        .editable:hover {
            background: #f0f9ff;
        }

        .editable input,
        .editable select {
            width: 100%;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            padding: 4px;
            text-align: inherit;
        }

        .task-cell input[type="text"] {
            border: 1px solid transparent;
            background: white;
            padding: 6px 8px;
            border-radius: 4px;
            font-family: var(--font-family-body);
            font-size: 14px;
            color: var(--color-neutral-text);
        }

        .task-cell input[type="text"]:hover {
            border-color: var(--color-neutral-border);
        }

        .task-cell input[type="text"]:focus {
            outline: 2px solid var(--color-primary-blue);
            border-color: var(--color-primary-blue);
        }

        /* WBS Numbering */
        .wbs-number {
            display: inline-block;
            min-width: 45px;
            padding: 4px 8px;
            background: var(--color-neutral-background);
            border-radius: 4px;
            font-family: var(--font-family-ui);
            font-size: 12px;
            font-weight: 600;
            color: var(--color-neutral-text);
            text-align: center;
            margin-right: 8px;
        }

        .editable select {
            cursor: pointer;
            appearance: none;
            text-align: center;
        }

        /* RACI Value Badges */
        .raci-value {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 12px;
        }

        .raci-value.R {
            background: #dcfce7;
            color: #166534;
        }

        .raci-value.A {
            background: #dbeafe;
            color: #1e40af;
        }

        .raci-value.C {
            background: #fef3c7;
            color: #92400e;
        }

        .raci-value.I {
            background: #f3e8ff;
            color: #6b21a8;
        }

        /* RACI Cell Color Coding */
        .role-cell.raci-R {
            background: #dcfce7 !important;
        }

        .role-cell.raci-A {
            background: #dbeafe !important;
        }

        .role-cell.raci-C {
            background: #fef3c7 !important;
        }

        .role-cell.raci-I {
            background: #f3e8ff !important;
        }

        .role-cell.raci-R select,
        .role-cell.raci-A select,
        .role-cell.raci-C select,
        .role-cell.raci-I select {
            background: transparent;
            font-weight: 600;
        }

        .role-cell.raci-R select {
            color: #166534;
        }

        .role-cell.raci-A select {
            color: #1e40af;
        }

        .role-cell.raci-C select {
            color: #92400e;
        }

        .role-cell.raci-I select {
            color: #6b21a8;
        }

        /* Tooltip */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--color-neutral-background);
            color: var(--color-neutral-text-light);
            font-size: 12px;
            cursor: help;
            margin-left: 6px;
            position: relative;
            transition: all 0.2s;
        }

        .info-icon:hover {
            background: var(--color-primary-blue);
            color: white;
        }

        .tooltip-wrapper {
            position: relative;
            display: inline-block;
        }

        .hover-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--color-dark);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-family: var(--font-family-body);
            font-size: 13px;
            line-height: 1.5;
            white-space: normal;
            width: 280px;
            max-width: 90vw;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            pointer-events: none;
        }

        .hover-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--color-dark);
        }

        .info-icon:hover .hover-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Action Buttons */
        .action-btn {
            padding: 6px;
            background: white;
            border: 1px solid var(--color-neutral-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .action-btn:hover {
            background: var(--color-neutral-background);
        }

        .action-btn.delete:hover {
            border-color: #dc2626;
            background: #fef2f2;
            color: #dc2626;
        }

        .action-btn.date-btn.has-dates {
            color: var(--color-primary-blue);
            border-color: var(--color-primary-blue);
            background: #e3f2fd;
        }

        .action-btn.date-btn:hover {
            border-color: var(--color-primary-blue);
            background: #e3f2fd;
        }

        .action-btn.copy-btn:hover {
            border-color: #16a34a;
            background: #f0fdf4;
            color: #16a34a;
        }

        /* Date Picker Modal */
        .date-picker-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s;
        }

        .date-picker-modal {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s;
        }

        .date-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .date-picker-header h3 {
            font-family: var(--font-family-ui);
            font-size: 20px;
            margin: 0;
            color: var(--color-dark);
        }

        .date-picker-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-neutral-text-light);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .date-picker-close:hover {
            background: var(--color-neutral-background);
            color: var(--color-dark);
        }

        .date-picker-body {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .date-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .date-field label {
            font-family: var(--font-family-ui);
            font-size: 13px;
            font-weight: 600;
            color: var(--color-neutral-text);
        }

        .date-field input[type="date"] {
            padding: 10px;
            border: 1px solid var(--color-neutral-border);
            border-radius: 6px;
            font-family: var(--font-family-body);
            font-size: 14px;
            color: var(--color-neutral-text);
            transition: all 0.2s;
        }

        .date-field input[type="date"]:focus {
            outline: none;
            border-color: var(--color-primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .date-field textarea {
            padding: 10px;
            border: 1px solid var(--color-neutral-border);
            border-radius: 6px;
            font-family: var(--font-family-body);
            font-size: 14px;
            color: var(--color-neutral-text);
            transition: all 0.2s;
            resize: vertical;
            min-height: 80px;
            line-height: 1.5;
        }

        .date-field textarea:focus {
            outline: none;
            border-color: var(--color-primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .date-field textarea::placeholder {
            color: var(--color-neutral-text-muted);
        }

        .date-picker-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .date-picker-actions button {
            flex: 1;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-family: var(--font-family-ui);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-picker-actions .btn-save {
            background: var(--color-primary-blue);
            color: white;
        }

        .date-picker-actions .btn-save:hover {
            background: #0052a3;
            box-shadow: 0 2px 8px rgba(0, 102, 204, 0.3);
        }

        .date-picker-actions .btn-cancel {
            background: white;
            color: var(--color-neutral-text);
            border: 1px solid var(--color-neutral-border);
        }

        .date-picker-actions .btn-cancel:hover {
            background: var(--color-neutral-background);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* RACI Management Modal */
        .raci-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.2s;
        }

        .raci-modal {
            background: white;
            border-radius: 12px;
            width: 500px;
            max-width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s;
        }

        .raci-modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--color-neutral-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .raci-modal-header h3 {
            font-family: var(--font-family-ui);
            font-size: 20px;
            margin: 0;
            color: var(--color-dark);
        }

        .raci-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-neutral-text-light);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .raci-modal-close:hover {
            background: var(--color-neutral-background);
            color: var(--color-dark);
        }

        .raci-modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        /* RACI Visibility Toggle */
        .raci-visibility-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--color-neutral-background);
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--color-primary-blue);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-label {
            font-family: var(--font-family-ui);
            font-size: 14px;
            font-weight: 500;
            color: var(--color-neutral-text);
        }

        /* Add Role Section */
        .add-role-section {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .role-input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid var(--color-neutral-border);
            border-radius: 8px;
            font-family: var(--font-family-body);
            font-size: 14px;
            color: var(--color-neutral-text);
            transition: all 0.2s;
        }

        .role-input:focus {
            outline: none;
            border-color: var(--color-primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        /* Roles List */
        .roles-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .role-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: white;
            border: 1px solid var(--color-neutral-border);
            border-radius: 8px;
            transition: all 0.2s;
            cursor: move;
        }

        .role-item:hover {
            border-color: var(--color-primary-blue);
            box-shadow: 0 2px 8px rgba(0, 102, 204, 0.1);
        }

        .role-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .role-item.drag-over {
            border-top: 3px solid var(--color-primary-blue);
        }

        .role-item-drag-handle {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            cursor: move;
        }

        .role-item-drag-icon {
            color: var(--color-neutral-text-light);
            font-size: 16px;
        }

        .role-item-name {
            font-family: var(--font-family-ui);
            font-size: 14px;
            font-weight: 500;
            color: var(--color-neutral-text);
            flex: 1;
        }

        .role-item-actions {
            display: flex;
            gap: 8px;
        }

        .role-item-btn {
            padding: 6px;
            background: white;
            border: 1px solid var(--color-neutral-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .role-item-btn:hover {
            background: var(--color-neutral-background);
        }

        .role-item-btn.delete:hover {
            border-color: #dc2626;
            background: #fef2f2;
            color: #dc2626;
        }

        /* Role Delete Button */
        .role-delete-btn {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            padding: 4px;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
            color: var(--color-neutral-text-muted);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .role-cell:hover .role-delete-btn {
            opacity: 1;
        }

        .role-delete-btn:hover {
            background: #fef2f2;
            color: #dc2626;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xxxl);
            color: var(--color-neutral-text-light);
        }

        .empty-state i {
            font-size: 64px;
            color: var(--color-neutral-border);
            margin-bottom: var(--spacing-lg);
        }

        .empty-state h3 {
            font-family: var(--font-family-ui);
            font-size: var(--font-size-h3);
            margin-bottom: var(--spacing-sm);
        }

        /* Data Menu Dropdown */
        .data-menu {
            position: relative;
            display: inline-block;
        }

        .data-menu-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: calc(100% + 4px);
            background: white;
            border: 1px solid var(--color-neutral-border);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 1000;
            overflow: hidden;
        }

        .data-menu-dropdown.show {
            display: block;
        }

        .data-menu-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: var(--font-family-ui);
            font-size: 13px;
            color: var(--color-dark);
            cursor: pointer;
            transition: background 0.2s;
        }

        .data-menu-item i {
            font-size: 16px;
            color: var(--color-primary-blue);
        }

        .data-menu-item:hover {
            background: var(--color-neutral-background);
        }

        .data-menu-item.danger {
            color: #dc2626;
        }

        .data-menu-item.danger i {
            color: #dc2626;
        }

        .data-menu-item.danger:hover {
            background: #fef2f2;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: var(--spacing-xxxl) var(--spacing-xxl);
            color: var(--color-neutral-text-light);
            font-size: var(--font-size-small);
        }

        footer a {
            color: var(--color-primary-blue);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding-top: 100px; /* Adjust for smaller mobile header */
            }

            header {
                padding: var(--spacing-md) var(--spacing-lg);
            }

            .header-content {
                flex-direction: row;
                gap: var(--spacing-md);
                justify-content: center;
            }

            .header-text {
                text-align: left;
                flex: 1;
            }

            .header-text h1 {
                font-size: 18px;
            }

            .header-text p {
                font-size: 11px;
                margin-top: 2px;
            }

            .header-logo {
                height: 30px;
                flex-shrink: 0;
            }

            /* Make floating home button icon-only on mobile */
            .floating-home-btn {
                padding: 8px;
                top: 10px;
                left: 10px;
                width: 36px;
                height: 36px;
                justify-content: center;
                gap: 0;
            }

            .floating-home-btn i {
                font-size: 18px;
            }

            /* Hide the "Home" text on mobile */
            .floating-home-btn .home-text {
                display: none;
            }

            main {
                padding: var(--spacing-lg);
            }

            .project-name-section {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-sm);
            }

            .project-name-section label {
                font-size: 12px;
            }

            .project-name-input {
                font-size: 16px;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-left,
            .toolbar-right {
                width: 100%;
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .raci-legend {
                grid-template-columns: 1fr;
                padding: var(--spacing-md);
            }

            .legend-item {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }

            .table-container {
                padding: var(--spacing-lg);
            }

            .raci-table {
                font-size: 12px;
            }

            .raci-table th,
            .raci-table td {
                padding: 8px;
                min-width: 80px;
            }

            .role-delete-btn {
                opacity: 1;
            }

            /* Mobile-specific phase and action buttons */
            .phase-action-btn,
            .action-btn {
                font-size: 14px;
                padding: 8px;
            }

            /* Date picker modal adjustments */
            .date-picker-modal {
                width: 95%;
                max-width: 350px;
            }

            /* Examples panel */
            .examples-panel {
                width: 95%;
            }

            .examples-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Extra small devices (< 480px) */
        @media (max-width: 480px) {
            body {
                padding-top: 90px;
            }

            .header-text h1 {
                font-size: 16px;
            }

            .header-text p {
                display: none;
            }

            .header-logo {
                height: 25px;
            }

            .project-name-input {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="floating-home-btn">
        <i class="ph ph-arrow-left"></i>
        <span class="home-text">Home</span>
    </a>

    <header>
        <div class="header-content">
            <div class="header-text">
                <h1>Project Planner</h1>
                <p>Plan and manage projects with RACI matrices, task scheduling, and work breakdown structures</p>
            </div>
            <img src="assets/high-resolution-logo-files/white-on-transparent.png"
                 alt="Cleansheet Logo"
                 class="header-logo">
        </div>
    </header>

    <main>
        <div class="project-name-section">
            <label for="projectNameInput">Project Name:</label>
            <input type="text" id="projectNameInput" class="project-name-input" placeholder="Enter project name..." />
        </div>

        <div class="toolbar">
            <div class="toolbar-left">
                <button class="btn btn-primary" onclick="addPhase()">
                    <i class="ph ph-folder-plus"></i>
                    Add Phase
                </button>
                <button class="btn btn-primary" onclick="addTask()">
                    <i class="ph ph-plus"></i>
                    Add Task
                </button>
            </div>
            <div class="toolbar-right">
                <button class="btn btn-secondary" onclick="openRaciModal()">
                    <i class="ph ph-users-three"></i>
                    Manage RACI
                </button>
                <button class="btn btn-toggle" id="raciToggle" onclick="toggleRaciVisibilityFromButton()">
                    <i class="ph ph-eye"></i>
                    Show RACI
                </button>
                <button class="btn btn-toggle" id="wbsToggle" onclick="toggleWBS()">
                    <i class="ph ph-list-numbers"></i>
                    WBS Numbering
                </button>
                <button class="btn btn-secondary" onclick="toggleExamplesPanel()">
                    <i class="ph ph-lightbulb"></i>
                    Examples
                </button>
                <div class="data-menu">
                    <button class="btn btn-secondary" onclick="toggleDataMenu()">
                        <i class="ph ph-dots-three-vertical"></i>
                        Data
                    </button>
                    <div class="data-menu-dropdown" id="dataMenu">
                        <button class="data-menu-item" onclick="exportJSON(); toggleDataMenu();">
                            <i class="ph ph-download-simple"></i>
                            Export JSON
                        </button>
                        <button class="data-menu-item" onclick="exportCSV(); toggleDataMenu();">
                            <i class="ph ph-file-csv"></i>
                            Export CSV
                        </button>
                        <button class="data-menu-item" onclick="document.getElementById('importFile').click(); toggleDataMenu();">
                            <i class="ph ph-upload-simple"></i>
                            Import JSON
                        </button>
                        <button class="data-menu-item danger" onclick="clearAll(); toggleDataMenu();">
                            <i class="ph ph-trash"></i>
                            Clear All
                        </button>
                    </div>
                </div>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importJSON(event)">
            </div>
        </div>

        <div class="examples-panel" id="examplesPanel" style="display: none;">
            <div class="examples-header">
                <h3>Load Example Project</h3>
                <p>Choose a template to get started quickly</p>
            </div>
            <div class="examples-grid">
                <div class="example-card" onclick="loadExample('event-plan')">
                    <i class="ph ph-calendar-check"></i>
                    <h4>Event Plan</h4>
                    <p>4 roles, 2 phases, 16 activities<br>Corporate event planning</p>
                </div>
                <div class="example-card" onclick="loadExample('software-release')">
                    <i class="ph ph-rocket-launch"></i>
                    <h4>Software Release</h4>
                    <p>5 roles, 3 phases, 18 activities<br>Product deployment cycle</p>
                </div>
                <div class="example-card" onclick="loadExample('marketing-launch')">
                    <i class="ph ph-megaphone"></i>
                    <h4>Marketing Launch</h4>
                    <p>5 roles, 3 phases, 19 activities<br>Campaign rollout plan</p>
                </div>
            </div>
        </div>

        <!-- RACI Management Modal -->
        <div class="raci-modal-overlay" id="raciModal" style="display: none;" onclick="if(event.target === this) closeRaciModal()">
            <div class="raci-modal">
                <div class="raci-modal-header">
                    <h3>Manage RACI Columns</h3>
                    <button class="raci-modal-close" onclick="closeRaciModal()">
                        <i class="ph ph-x"></i>
                    </button>
                </div>
                <div class="raci-modal-body">
                    <!-- Toggle to show/hide RACI columns -->
                    <div class="raci-visibility-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="raciVisibilityToggle" onchange="toggleRaciVisibility()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Show RACI columns in table</span>
                    </div>

                    <!-- Add new role -->
                    <div class="add-role-section">
                        <input type="text" id="newRoleInput" placeholder="Enter new role name..." class="role-input" onkeypress="if(event.key==='Enter') addRoleFromModal()">
                        <button class="btn btn-primary" onclick="addRoleFromModal()">
                            <i class="ph ph-plus"></i>
                            Add Role
                        </button>
                    </div>

                    <!-- Roles list -->
                    <div class="roles-list" id="rolesList">
                        <!-- Roles will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="raci-legend">
            <div class="legend-item">
                <span class="raci-value R">R</span>
                <span class="legend-text"><strong>Responsible:</strong> People who do the work to <br>complete the task</span>
            </div>
            <div class="legend-item">
                <span class="raci-value A">A</span>
                <span class="legend-text"><strong>Accountable:</strong> Person ultimately answerable <br>for completion (only one per task)</span>
            </div>
            <div class="legend-item">
                <span class="raci-value C">C</span>
                <span class="legend-text"><strong>Consulted:</strong> People whose input is needed  <br>(two-way communication)</span>
            </div>
            <div class="legend-item">
                <span class="raci-value I">I</span>
                <span class="legend-text"><strong>Informed:</strong> People kept updated on progress <br>(one-way communication)</span>
            </div>
        </div>

        <div class="table-container">
            <div id="emptyState" class="empty-state" style="display: none;">
                <i class="ph ph-table"></i>
                <h3>No Tasks Yet</h3>
                <p>Click "Add Task" to create your first project task</p>
            </div>

            <table class="raci-table" id="raciTable">
                <tbody id="tableBody">
                    <!-- Rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Cleansheet LLC. All rights reserved.</p>
        <p style="margin-top: 8px;">
            <a href="https://www.cleansheet.info">cleansheet.info</a> |
            <a href="privacy-policy.html">Privacy Policy</a> |
            <a href="terms-of-service.html">Terms of Service</a>
        </p>
    </footer>

    <script src="shared/cleansheet-core.js"></script>
    <script>
        // Project Planner Data Model
        // WBS Numbering State
        let wbsEnabled = false;
        // Roles Visibility State
        // Initialize based on viewport: desktop shows RACI by default, mobile hides it
        let rolesVisible = window.innerWidth > 768;

        let raciData = {
            projectName: 'Untitled Project',
            roles: ['Senior Analyst', 'Project Manager', 'Designer Head', 'SVP Finance', 'SEO Lead', 'Sales Director', 'Upper Management'],
            phases: [
                {
                    id: generateId(),
                    name: 'Market Research',
                    collapsed: false
                },
                {
                    id: generateId(),
                    name: 'Project Structuring',
                    collapsed: false
                }
            ],
            tasks: [
                {
                    id: generateId(),
                    name: 'Market Research',
                    phaseId: null, // Will be set after phases are created
                    assignments: {
                        'Senior Analyst': 'R',
                        'Project Manager': 'I',
                        'Designer Head': 'I',
                        'SVP Finance': 'A',
                        'SEO Lead': 'C',
                        'Sales Director': 'I',
                        'Upper Management': 'I'
                    }
                },
                {
                    id: generateId(),
                    name: 'Econometric Model',
                    phaseId: null,
                    assignments: {
                        'Senior Analyst': 'A',
                        'Project Manager': 'I',
                        'Designer Head': 'I',
                        'SVP Finance': 'R',
                        'SEO Lead': 'I',
                        'Sales Director': 'I',
                        'Upper Management': 'C'
                    }
                },
                {
                    id: generateId(),
                    name: 'Strategic Framework',
                    phaseId: null,
                    assignments: {
                        'Senior Analyst': 'R',
                        'Project Manager': 'I',
                        'Designer Head': 'I',
                        'SVP Finance': 'A',
                        'SEO Lead': 'I',
                        'Sales Director': 'I',
                        'Upper Management': 'I'
                    }
                },
                {
                    id: generateId(),
                    name: 'Product Specification',
                    phaseId: null,
                    assignments: {
                        'Senior Analyst': 'I',
                        'Project Manager': 'A',
                        'Designer Head': 'R',
                        'SVP Finance': 'I',
                        'SEO Lead': 'C',
                        'Sales Director': 'C',
                        'Upper Management': 'C'
                    }
                },
                {
                    id: generateId(),
                    name: 'Design Wireframe',
                    phaseId: null,
                    assignments: {
                        'Senior Analyst': 'I',
                        'Project Manager': 'C',
                        'Designer Head': 'R',
                        'SVP Finance': 'I',
                        'SEO Lead': 'C',
                        'Sales Director': 'I',
                        'Upper Management': 'C'
                    }
                },
                {
                    id: generateId(),
                    name: 'Customer Journey',
                    phaseId: null,
                    assignments: {
                        'Senior Analyst': 'I',
                        'Project Manager': 'C',
                        'Designer Head': 'R',
                        'SVP Finance': 'I',
                        'SEO Lead': 'C',
                        'Sales Director': 'C',
                        'Upper Management': 'C'
                    }
                }
            ]
        };

        // Initialize phase assignments on first load
        function initializePhaseAssignments() {
            // Ensure phases array exists
            if (!raciData.phases) {
                raciData.phases = [];
            }

            // Ensure all tasks have phaseId property
            if (raciData.tasks) {
                raciData.tasks.forEach(task => {
                    if (task.phaseId === undefined) {
                        task.phaseId = null;
                    }
                });
            }

            if (raciData.phases.length >= 2 && raciData.tasks.length >= 6) {
                const phase1Id = raciData.phases[0].id;
                const phase2Id = raciData.phases[1].id;

                // Assign first 3 tasks to Phase 1, next 3 to Phase 2 (only if not already assigned)
                if (!raciData.tasks[0].phaseId) {
                    raciData.tasks[0].phaseId = phase1Id;
                    raciData.tasks[1].phaseId = phase1Id;
                    raciData.tasks[2].phaseId = phase1Id;
                    raciData.tasks[3].phaseId = phase2Id;
                    raciData.tasks[4].phaseId = phase2Id;
                    raciData.tasks[5].phaseId = phase2Id;
                }
            }
        }

        // Generate unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Initialize
        function init() {
            loadFromLocalStorage();
            initializePhaseAssignments();
            renderTable();

            // Set initial RACI visibility state
            const table = document.getElementById('raciTable');
            const raciToggle = document.getElementById('raciToggle');

            if (rolesVisible) {
                table.classList.remove('hide-roles');
                if (raciToggle) {
                    raciToggle.classList.add('active');
                    raciToggle.innerHTML = '<i class="ph ph-eye"></i> Show RACI';
                }
            } else {
                table.classList.add('hide-roles');
                if (raciToggle) {
                    raciToggle.classList.remove('active');
                    raciToggle.innerHTML = '<i class="ph ph-eye-slash"></i> Show RACI';
                }
            }

            // Add event listener for project name input
            const projectNameInput = document.getElementById('projectNameInput');
            if (projectNameInput) {
                projectNameInput.addEventListener('input', (e) => {
                    raciData.projectName = e.target.value.trim() || 'Untitled Project';
                    saveToLocalStorage();
                });
            }
        }

        // Render Table
        function renderTable() {
            const table = document.getElementById('raciTable');
            const emptyState = document.getElementById('emptyState');

            // Update project name input
            const projectNameInput = document.getElementById('projectNameInput');
            if (projectNameInput && projectNameInput.value !== raciData.projectName) {
                projectNameInput.value = raciData.projectName;
            }

            // Show empty state if no tasks
            if (raciData.tasks.length === 0) {
                table.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            emptyState.style.display = 'none';

            // Main header row removed - role management now done via modal
            // Role names appear in phase section headers instead

            // Render body with phases
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // Group tasks by phase
            const unassignedTasks = raciData.tasks.filter(t => !t.phaseId);

            // Render phases
            raciData.phases.forEach((phase, phaseIndex) => {
                const phaseTasks = raciData.tasks.filter(t => t.phaseId === phase.id);

                // Phase header row
                const phaseRow = document.createElement('tr');
                phaseRow.className = 'phase-row';

                const phaseCell = document.createElement('td');
                phaseCell.colSpan = raciData.roles.length + 2; // Span all columns
                phaseCell.className = 'phase-cell';

                const phaseHeader = document.createElement('div');
                phaseHeader.className = 'phase-header';

                const collapseBtn = document.createElement('button');
                collapseBtn.className = 'phase-collapse-btn';
                collapseBtn.innerHTML = phase.collapsed ? '<i class="ph ph-caret-right"></i>' : '<i class="ph ph-caret-down"></i>';
                collapseBtn.onclick = () => togglePhase(phase.id);

                // WBS Number for phase (if enabled)
                if (wbsEnabled) {
                    const phaseWbsNumber = document.createElement('span');
                    phaseWbsNumber.className = 'wbs-number';
                    phaseWbsNumber.textContent = `${phaseIndex + 1}.0`;
                    phaseWbsNumber.style.marginRight = '8px';
                    phaseHeader.appendChild(phaseWbsNumber);
                }

                const phaseName = document.createElement('input');
                phaseName.type = 'text';
                phaseName.className = 'phase-name-input';
                phaseName.value = phase.name;
                phaseName.onchange = (e) => updatePhaseName(phase.id, e.target.value);

                const phaseActions = document.createElement('div');
                phaseActions.className = 'phase-actions';

                // Move up button
                const moveUpBtn = document.createElement('button');
                moveUpBtn.className = 'phase-action-btn';
                moveUpBtn.innerHTML = '<i class="ph ph-arrow-up"></i>';
                moveUpBtn.title = 'Move phase up';
                moveUpBtn.onclick = () => movePhaseUp(phase.id);
                if (phaseIndex === 0) {
                    moveUpBtn.disabled = true;
                    moveUpBtn.style.opacity = '0.3';
                }

                // Move down button
                const moveDownBtn = document.createElement('button');
                moveDownBtn.className = 'phase-action-btn';
                moveDownBtn.innerHTML = '<i class="ph ph-arrow-down"></i>';
                moveDownBtn.title = 'Move phase down';
                moveDownBtn.onclick = () => movePhaseDown(phase.id);
                if (phaseIndex === raciData.phases.length - 1) {
                    moveDownBtn.disabled = true;
                    moveDownBtn.style.opacity = '0.3';
                }

                const addTaskBtn = document.createElement('button');
                addTaskBtn.className = 'phase-action-btn';
                addTaskBtn.innerHTML = '<i class="ph ph-plus"></i>';
                addTaskBtn.title = 'Add task to this phase';
                addTaskBtn.onclick = () => addTaskToPhase(phase.id);

                const deletePhaseBtn = document.createElement('button');
                deletePhaseBtn.className = 'phase-action-btn delete';
                deletePhaseBtn.innerHTML = '<i class="ph ph-trash"></i>';
                deletePhaseBtn.title = 'Delete phase';
                deletePhaseBtn.onclick = () => deletePhase(phase.id);

                phaseActions.appendChild(moveUpBtn);
                phaseActions.appendChild(moveDownBtn);
                phaseActions.appendChild(addTaskBtn);
                phaseActions.appendChild(deletePhaseBtn);

                phaseHeader.appendChild(collapseBtn);
                phaseHeader.appendChild(phaseName);
                phaseHeader.appendChild(phaseActions);

                phaseCell.appendChild(phaseHeader);
                phaseRow.appendChild(phaseCell);
                tbody.appendChild(phaseRow);

                // Add role header row after phase header (if not collapsed)
                if (!phase.collapsed) {
                    const roleHeaderRow = document.createElement('tr');
                    roleHeaderRow.className = 'role-header-row';

                    // Task column header
                    const taskHeader = document.createElement('th');
                    taskHeader.textContent = 'Task';
                    taskHeader.style.width = '300px';
                    roleHeaderRow.appendChild(taskHeader);

                    // Role column headers
                    raciData.roles.forEach(role => {
                        const th = document.createElement('th');
                        th.className = 'role-header';
                        th.textContent = role;
                        th.style.width = '100px';
                        roleHeaderRow.appendChild(th);
                    });

                    // Actions column header
                    const actionsHeader = document.createElement('th');
                    actionsHeader.textContent = 'Actions';
                    actionsHeader.style.width = '100px';
                    roleHeaderRow.appendChild(actionsHeader);

                    tbody.appendChild(roleHeaderRow);

                    // Render tasks in phase
                    phaseTasks.forEach((task, taskIndex) => {
                        const phaseIndex = raciData.phases.indexOf(phase);
                        tbody.appendChild(createTaskRow(task, phaseIndex + 1, taskIndex + 1));
                    });
                }
            });

            // Render unassigned tasks at the bottom
            if (unassignedTasks.length > 0) {
                const unassignedRow = document.createElement('tr');
                unassignedRow.className = 'phase-row';

                const unassignedCell = document.createElement('td');
                unassignedCell.colSpan = raciData.roles.length + 2;
                unassignedCell.className = 'phase-cell unassigned';

                const unassignedHeader = document.createElement('div');
                unassignedHeader.className = 'phase-header';

                // Unassigned tasks get sequential numbering starting after all phases
                const unassignedPhaseNumber = raciData.phases.length + 1;

                // WBS Number for unassigned section (if enabled)
                if (wbsEnabled) {
                    const unassignedWbsNumber = document.createElement('span');
                    unassignedWbsNumber.className = 'wbs-number';
                    unassignedWbsNumber.textContent = `${unassignedPhaseNumber}.0`;
                    unassignedWbsNumber.style.marginRight = '8px';
                    unassignedHeader.appendChild(unassignedWbsNumber);
                }

                const warningIcon = document.createElement('i');
                warningIcon.className = 'ph ph-warning';
                warningIcon.style.marginRight = '8px';
                unassignedHeader.appendChild(warningIcon);

                const unassignedText = document.createTextNode('Unassigned Tasks');
                unassignedHeader.appendChild(unassignedText);

                unassignedCell.appendChild(unassignedHeader);
                unassignedRow.appendChild(unassignedCell);
                tbody.appendChild(unassignedRow);
                unassignedTasks.forEach((task, taskIndex) => {
                    tbody.appendChild(createTaskRow(task, unassignedPhaseNumber, taskIndex + 1));
                });
            }

            saveToLocalStorage();
        }

        // Create task row
        function createTaskRow(task, phaseNumber, taskNumber) {
            const tr = document.createElement('tr');
            tr.className = 'task-row';
            tr.draggable = true;
            tr.dataset.taskId = task.id;

            // Add drag event listeners
            tr.addEventListener('dragstart', handleDragStart);
            tr.addEventListener('dragend', handleDragEnd);
            tr.addEventListener('dragover', handleDragOver);
            tr.addEventListener('drop', handleDrop);
            tr.addEventListener('dragleave', handleDragLeave);

            // Task name with drag handle and phase selector
            const taskCell = document.createElement('td');
            taskCell.className = 'task-cell editable';

            const taskInput = document.createElement('div');
            taskInput.className = 'task-input-container';

            // Drag handle
            const dragHandle = document.createElement('span');
            dragHandle.className = 'drag-handle';
            dragHandle.innerHTML = '<i class="ph ph-dots-six-vertical"></i>';
            dragHandle.title = 'Drag to reorder';

            // WBS Number (if enabled)
            if (wbsEnabled && phaseNumber !== null && taskNumber !== null) {
                const wbsNumber = document.createElement('span');
                wbsNumber.className = 'wbs-number';
                wbsNumber.textContent = `${phaseNumber}.${taskNumber}`;
                taskInput.appendChild(wbsNumber);
            }

            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.value = task.name;
            nameInput.onchange = () => updateTaskName(task.id, nameInput.value);

            // Phase selector with icon dropdown
            const phaseSelectorWrapper = document.createElement('div');
            phaseSelectorWrapper.className = 'phase-selector-wrapper';

            const phaseSelectorBtn = document.createElement('button');
            phaseSelectorBtn.className = 'phase-selector-btn';
            if (task.phaseId) {
                phaseSelectorBtn.classList.add('has-phase');
            }
            phaseSelectorBtn.innerHTML = '<i class="ph ph-folder"></i>';
            phaseSelectorBtn.title = 'Assign to phase';
            phaseSelectorBtn.type = 'button';

            const phaseDropdown = document.createElement('div');
            phaseDropdown.className = 'phase-dropdown';

            // Add "No phase" option
            const noneOption = document.createElement('div');
            noneOption.className = 'phase-option none';
            if (!task.phaseId) {
                noneOption.classList.add('selected');
            }
            noneOption.textContent = 'No phase';
            noneOption.onclick = () => {
                updateTaskPhase(task.id, '');
                phaseDropdown.classList.remove('show');
            };
            phaseDropdown.appendChild(noneOption);

            // Add phase options
            raciData.phases.forEach(phase => {
                const option = document.createElement('div');
                option.className = 'phase-option';
                if (task.phaseId === phase.id) {
                    option.classList.add('selected');
                }
                option.textContent = phase.name;
                option.onclick = () => {
                    updateTaskPhase(task.id, phase.id);
                    phaseDropdown.classList.remove('show');
                };
                phaseDropdown.appendChild(option);
            });

            // Toggle dropdown on button click
            phaseSelectorBtn.onclick = (e) => {
                e.stopPropagation();
                // Close all other dropdowns
                document.querySelectorAll('.phase-dropdown.show').forEach(d => {
                    if (d !== phaseDropdown) d.classList.remove('show');
                });
                phaseDropdown.classList.toggle('show');
            };

            phaseSelectorWrapper.appendChild(phaseSelectorBtn);
            phaseSelectorWrapper.appendChild(phaseDropdown);

            taskInput.appendChild(dragHandle);
            taskInput.appendChild(nameInput);
            taskInput.appendChild(phaseSelectorWrapper);
            taskCell.appendChild(taskInput);
            tr.appendChild(taskCell);

            // Role assignment columns (one cell per role)
            raciData.roles.forEach(role => {
                const roleCell = document.createElement('td');
                const value = task.assignments[role] || '';
                roleCell.className = 'role-cell editable';

                // Add color coding class based on value
                if (value) {
                    roleCell.classList.add(`raci-${value}`);
                }

                roleCell.innerHTML = `
                    <select onchange="updateAssignment('${task.id}', '${role}', this.value)">
                        <option value="">-</option>
                        <option value="R" ${value === 'R' ? 'selected' : ''}>R</option>
                        <option value="A" ${value === 'A' ? 'selected' : ''}>A</option>
                        <option value="C" ${value === 'C' ? 'selected' : ''}>C</option>
                        <option value="I" ${value === 'I' ? 'selected' : ''}>I</option>
                    </select>
                `;
                tr.appendChild(roleCell);
            });

            // Actions
            const actionsCell = document.createElement('td');
            actionsCell.className = 'actions-cell';

            // Date button
            const dateBtn = document.createElement('button');
            dateBtn.className = 'action-btn date-btn';
            dateBtn.title = 'Set dates';
            dateBtn.innerHTML = '<i class="ph ph-calendar"></i>';
            if (task.startDate || task.endDate) {
                dateBtn.classList.add('has-dates');
            }
            dateBtn.onclick = () => showDatePicker(task.id);

            // Copy button
            const copyBtn = document.createElement('button');
            copyBtn.className = 'action-btn copy-btn';
            copyBtn.title = 'Copy task';
            copyBtn.innerHTML = '<i class="ph ph-copy"></i>';
            copyBtn.onclick = () => copyTask(task.id);

            // Delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'action-btn delete';
            deleteBtn.title = 'Delete Task';
            deleteBtn.innerHTML = '<i class="ph ph-trash"></i>';
            deleteBtn.onclick = () => deleteTask(task.id);

            actionsCell.appendChild(dateBtn);
            actionsCell.appendChild(copyBtn);
            actionsCell.appendChild(deleteBtn);
            tr.appendChild(actionsCell);

            return tr;
        }

        // Drag and Drop Variables
        let draggedTaskId = null;
        let draggedPhaseId = null;

        // Drag and Drop Handlers
        function handleDragStart(e) {
            const row = e.target.closest('.task-row');
            if (!row) return;

            draggedTaskId = row.dataset.taskId;

            // Get the phase this task belongs to
            const task = raciData.tasks.find(t => t.id === draggedTaskId);
            draggedPhaseId = task ? task.phaseId : null;

            row.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', row.innerHTML);
        }

        function handleDragEnd(e) {
            const row = e.target.closest('.task-row');
            if (row) {
                row.classList.remove('dragging');
            }

            // Remove all drag-over classes
            document.querySelectorAll('.task-row').forEach(r => {
                r.classList.remove('drag-over');
            });

            draggedTaskId = null;
            draggedPhaseId = null;
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }

            const row = e.target.closest('.task-row');
            if (row && row.dataset.taskId !== draggedTaskId) {
                row.classList.add('drag-over');
            }

            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragLeave(e) {
            const row = e.target.closest('.task-row');
            if (row) {
                row.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            const targetRow = e.target.closest('.task-row');
            if (!targetRow || !draggedTaskId) return false;

            const targetTaskId = targetRow.dataset.taskId;
            if (draggedTaskId === targetTaskId) return false;

            // Find tasks
            const draggedTask = raciData.tasks.find(t => t.id === draggedTaskId);
            const targetTask = raciData.tasks.find(t => t.id === targetTaskId);

            if (!draggedTask || !targetTask) return false;

            // Only allow reordering within the same phase
            if (draggedTask.phaseId !== targetTask.phaseId) {
                CleansheetCore.utils.showToast('Can only reorder tasks within the same phase', 'error');
                return false;
            }

            // Get current indices
            const draggedIndex = raciData.tasks.indexOf(draggedTask);
            const targetIndex = raciData.tasks.indexOf(targetTask);

            // Reorder tasks array
            raciData.tasks.splice(draggedIndex, 1);
            const newTargetIndex = raciData.tasks.indexOf(targetTask);
            raciData.tasks.splice(newTargetIndex, 0, draggedTask);

            // Save and re-render
            saveToLocalStorage();
            renderTable();
            CleansheetCore.utils.showToast('Task reordered', 'success');

            return false;
        }

        // Add Phase
        function addPhase() {
            const phaseName = prompt('Enter phase name:');
            if (!phaseName) return;

            const newPhase = {
                id: generateId(),
                name: phaseName,
                collapsed: false
            };

            raciData.phases.push(newPhase);
            renderTable();
            CleansheetCore.utils.showToast('Phase added successfully', 'success');
        }

        // Add Task
        function addTask() {
            const taskName = prompt('Enter task name:');
            if (!taskName) return;

            const newTask = {
                id: generateId(),
                name: taskName,
                phaseId: null,
                assignments: {}
            };

            // Initialize empty assignments for all roles
            raciData.roles.forEach(role => {
                newTask.assignments[role] = '';
            });

            raciData.tasks.push(newTask);
            renderTable();
            CleansheetCore.utils.showToast('Task added successfully', 'success');
        }

        // Add Task to Phase
        function addTaskToPhase(phaseId) {
            const taskName = prompt('Enter task name:');
            if (!taskName) return;

            const newTask = {
                id: generateId(),
                name: taskName,
                phaseId: phaseId,
                assignments: {}
            };

            // Initialize empty assignments for all roles
            raciData.roles.forEach(role => {
                newTask.assignments[role] = '';
            });

            raciData.tasks.push(newTask);
            renderTable();
            CleansheetCore.utils.showToast('Task added to phase', 'success');
        }

        // Toggle Phase Collapse
        function togglePhase(phaseId) {
            const phase = raciData.phases.find(p => p.id === phaseId);
            if (phase) {
                phase.collapsed = !phase.collapsed;
                renderTable();
            }
        }

        // Update Phase Name
        function updatePhaseName(phaseId, newName) {
            const phase = raciData.phases.find(p => p.id === phaseId);
            if (phase) {
                phase.name = newName;
                saveToLocalStorage();
            }
        }

        // Update Task Phase Assignment
        function updateTaskPhase(taskId, phaseId) {
            const task = raciData.tasks.find(t => t.id === taskId);
            if (task) {
                task.phaseId = phaseId || null;
                renderTable();
            }
        }

        // Delete Phase
        function deletePhase(phaseId) {
            const phase = raciData.phases.find(p => p.id === phaseId);
            if (!phase) return;

            const phaseTasks = raciData.tasks.filter(t => t.phaseId === phaseId);
            if (phaseTasks.length > 0) {
                if (!confirm(`Phase "${phase.name}" contains ${phaseTasks.length} task(s). Delete anyway? Tasks will be unassigned.`)) {
                    return;
                }
                // Unassign tasks from this phase
                phaseTasks.forEach(task => {
                    task.phaseId = null;
                });
            }

            raciData.phases = raciData.phases.filter(p => p.id !== phaseId);
            renderTable();
            CleansheetCore.utils.showToast('Phase deleted', 'success');
        }

        // Move Phase Up
        function movePhaseUp(phaseId) {
            const phaseIndex = raciData.phases.findIndex(p => p.id === phaseId);
            if (phaseIndex <= 0) return; // Already at the top or not found

            // Swap with the phase above
            [raciData.phases[phaseIndex - 1], raciData.phases[phaseIndex]] =
            [raciData.phases[phaseIndex], raciData.phases[phaseIndex - 1]];

            renderTable();
            saveToLocalStorage();
            CleansheetCore.utils.showToast('Phase moved up', 'success');
        }

        // Move Phase Down
        function movePhaseDown(phaseId) {
            const phaseIndex = raciData.phases.findIndex(p => p.id === phaseId);
            if (phaseIndex < 0 || phaseIndex >= raciData.phases.length - 1) return; // Already at the bottom or not found

            // Swap with the phase below
            [raciData.phases[phaseIndex], raciData.phases[phaseIndex + 1]] =
            [raciData.phases[phaseIndex + 1], raciData.phases[phaseIndex]];

            renderTable();
            saveToLocalStorage();
            CleansheetCore.utils.showToast('Phase moved down', 'success');
        }

        // Add Role
        // Update Task Name
        function updateTaskName(taskId, newName) {
            const task = raciData.tasks.find(t => t.id === taskId);
            if (task) {
                task.name = newName;
                saveToLocalStorage();
            }
        }

        // Update Assignment
        function updateAssignment(taskId, role, value) {
            const task = raciData.tasks.find(t => t.id === taskId);
            if (task) {
                task.assignments[role] = value;
                renderTable();
            }
        }

        // Edit Role Name
        function editRoleName(oldName) {
            const newName = prompt('Enter new role name:', oldName);
            if (!newName || newName === oldName) return;

            if (raciData.roles.includes(newName)) {
                CleansheetCore.utils.showToast('Role name already exists', 'error');
                return;
            }

            // Update role name
            const index = raciData.roles.indexOf(oldName);
            raciData.roles[index] = newName;

            // Update all task assignments
            raciData.tasks.forEach(task => {
                if (task.assignments[oldName] !== undefined) {
                    task.assignments[newName] = task.assignments[oldName];
                    delete task.assignments[oldName];
                }
            });

            renderTable();
            CleansheetCore.utils.showToast('Role renamed successfully', 'success');
        }

        // Delete Task
        // Show Date Picker Modal
        function showDatePicker(taskId) {
            const task = raciData.tasks.find(t => t.id === taskId);
            if (!task) return;

            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'date-picker-overlay';
            overlay.onclick = (e) => {
                if (e.target === overlay) closeDatePicker();
            };

            // Create modal
            const modal = document.createElement('div');
            modal.className = 'date-picker-modal';
            modal.onclick = (e) => e.stopPropagation();

            // Header
            const header = document.createElement('div');
            header.className = 'date-picker-header';
            header.innerHTML = `
                <h3>Set Task Dates</h3>
                <button class="date-picker-close" onclick="closeDatePicker()">
                    <i class="ph ph-x"></i>
                </button>
            `;

            // Body
            const body = document.createElement('div');
            body.className = 'date-picker-body';

            const taskName = document.createElement('p');
            taskName.style.cssText = 'font-family: var(--font-family-body); font-size: 14px; color: var(--color-neutral-text-light); margin-bottom: 16px;';
            taskName.textContent = task.name;

            const startField = document.createElement('div');
            startField.className = 'date-field';
            startField.innerHTML = `
                <label for="startDate">Start Date</label>
                <input type="date" id="startDate" value="${task.startDate || ''}" />
            `;

            const endField = document.createElement('div');
            endField.className = 'date-field';
            endField.innerHTML = `
                <label for="endDate">End Date</label>
                <input type="date" id="endDate" value="${task.endDate || ''}" />
            `;

            const dodField = document.createElement('div');
            dodField.className = 'date-field';
            dodField.innerHTML = `
                <label for="definitionOfDone">Definition of Done</label>
                <textarea id="definitionOfDone" placeholder="Enter completion criteria for this task..." rows="4">${task.definitionOfDone || ''}</textarea>
            `;

            body.appendChild(taskName);
            body.appendChild(startField);
            body.appendChild(endField);
            body.appendChild(dodField);

            // Actions
            const actions = document.createElement('div');
            actions.className = 'date-picker-actions';
            actions.innerHTML = `
                <button class="btn-cancel" onclick="closeDatePicker()">Cancel</button>
                <button class="btn-save" onclick="saveDates('${taskId}')">Save</button>
            `;

            modal.appendChild(header);
            modal.appendChild(body);
            modal.appendChild(actions);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
        }

        // Close Date Picker Modal
        function closeDatePicker() {
            const overlay = document.querySelector('.date-picker-overlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Save Task Dates
        function saveDates(taskId) {
            const task = raciData.tasks.find(t => t.id === taskId);
            if (!task) return;

            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const definitionOfDone = document.getElementById('definitionOfDone').value.trim();

            // Validate dates
            if (startDate && endDate && startDate > endDate) {
                CleansheetCore.utils.showToast('Start date must be before end date', 'error');
                return;
            }

            task.startDate = startDate || null;
            task.endDate = endDate || null;
            task.definitionOfDone = definitionOfDone || null;

            closeDatePicker();
            renderTable();
            CleansheetCore.utils.showToast('Task details saved', 'success');
        }

        // Copy Task
        function copyTask(taskId) {
            const task = raciData.tasks.find(t => t.id === taskId);
            if (!task) return;

            // Create a deep copy of the task
            const copiedTask = {
                id: generateId(),
                name: task.name + ' (Copy)',
                phaseId: task.phaseId,
                startDate: task.startDate || null,
                endDate: task.endDate || null,
                definitionOfDone: task.definitionOfDone || null,
                assignments: { ...task.assignments }
            };

            // Find the index of the original task
            const taskIndex = raciData.tasks.findIndex(t => t.id === taskId);

            // Insert the copied task right after the original
            raciData.tasks.splice(taskIndex + 1, 0, copiedTask);

            renderTable();
            CleansheetCore.utils.showToast('Task copied', 'success');
        }

        function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;

            raciData.tasks = raciData.tasks.filter(t => t.id !== taskId);
            renderTable();
            CleansheetCore.utils.showToast('Task deleted', 'success');
        }

        // Delete Role
        function deleteRole(role) {
            if (!confirm(`Are you sure you want to delete the role "${role}"? This will remove all assignments for this role.`)) return;

            // Remove role from roles array
            raciData.roles = raciData.roles.filter(r => r !== role);

            // Remove role assignments from all tasks
            raciData.tasks.forEach(task => {
                delete task.assignments[role];
            });

            renderTable();
            CleansheetCore.utils.showToast('Role deleted', 'success');
        }

        // Clear All
        // Toggle WBS Numbering
        function toggleWBS() {
            wbsEnabled = !wbsEnabled;
            const toggleBtn = document.getElementById('wbsToggle');
            if (wbsEnabled) {
                toggleBtn.classList.add('active');
                CleansheetCore.utils.showToast('WBS numbering enabled', 'success');
            } else {
                toggleBtn.classList.remove('active');
                CleansheetCore.utils.showToast('WBS numbering disabled', 'success');
            }
            renderTable();
        }

        // Toggle Roles Visibility
        // RACI Modal Functions
        function openRaciModal() {
            const modal = document.getElementById('raciModal');
            const toggle = document.getElementById('raciVisibilityToggle');

            // Set toggle state
            toggle.checked = rolesVisible;

            // Populate roles list
            renderRolesList();

            // Show modal
            modal.style.display = 'flex';
        }

        function closeRaciModal() {
            const modal = document.getElementById('raciModal');
            modal.style.display = 'none';
        }

        function renderRolesList() {
            const rolesList = document.getElementById('rolesList');
            rolesList.innerHTML = '';

            raciData.roles.forEach((role, index) => {
                const roleItem = document.createElement('div');
                roleItem.className = 'role-item';
                roleItem.draggable = true;
                roleItem.dataset.roleIndex = index;

                // Drag handle and name container
                const dragHandle = document.createElement('div');
                dragHandle.className = 'role-item-drag-handle';

                const dragIcon = document.createElement('i');
                dragIcon.className = 'ph ph-dots-six-vertical role-item-drag-icon';

                const roleName = document.createElement('span');
                roleName.className = 'role-item-name';
                roleName.textContent = role;

                dragHandle.appendChild(dragIcon);
                dragHandle.appendChild(roleName);

                // Actions
                const actions = document.createElement('div');
                actions.className = 'role-item-actions';

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'role-item-btn delete';
                deleteBtn.innerHTML = '<i class="ph ph-trash"></i>';
                deleteBtn.title = 'Delete role';
                deleteBtn.onclick = () => deleteRoleFromModal(role);

                actions.appendChild(deleteBtn);
                roleItem.appendChild(dragHandle);
                roleItem.appendChild(actions);

                // Drag event listeners
                roleItem.addEventListener('dragstart', handleDragStart);
                roleItem.addEventListener('dragover', handleDragOver);
                roleItem.addEventListener('drop', handleDrop);
                roleItem.addEventListener('dragend', handleDragEnd);
                roleItem.addEventListener('dragleave', handleDragLeave);

                rolesList.appendChild(roleItem);
            });
        }

        // Drag and Drop handlers
        let draggedRoleIndex = null;

        function handleDragStart(e) {
            draggedRoleIndex = parseInt(e.currentTarget.dataset.roleIndex);
            e.currentTarget.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const item = e.currentTarget;
            if (!item.classList.contains('dragging')) {
                item.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropIndex = parseInt(e.currentTarget.dataset.roleIndex);

            if (draggedRoleIndex !== null && draggedRoleIndex !== dropIndex) {
                // Reorder roles array
                const draggedRole = raciData.roles[draggedRoleIndex];
                raciData.roles.splice(draggedRoleIndex, 1);
                raciData.roles.splice(dropIndex, 0, draggedRole);

                // Re-render
                renderRolesList();
                renderTable();
                saveToLocalStorage();
                CleansheetCore.utils.showToast('Role order updated', 'success');
            }

            e.currentTarget.classList.remove('drag-over');
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            document.querySelectorAll('.role-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedRoleIndex = null;
        }

        function addRoleFromModal() {
            const input = document.getElementById('newRoleInput');
            const roleName = input.value.trim();

            if (!roleName) {
                CleansheetCore.utils.showToast('Please enter a role name', 'error');
                return;
            }

            if (raciData.roles.includes(roleName)) {
                CleansheetCore.utils.showToast('Role already exists', 'error');
                return;
            }

            raciData.roles.push(roleName);

            // Add empty assignments for this role in all tasks
            raciData.tasks.forEach(task => {
                if (!task.assignments) task.assignments = {};
                task.assignments[roleName] = '';
            });

            input.value = '';
            renderRolesList();
            renderTable();
            CleansheetCore.utils.showToast('Role added', 'success');
        }

        function deleteRoleFromModal(role) {
            if (!confirm(`Are you sure you want to delete the role "${role}"? This will remove all assignments for this role.`)) return;

            // Remove role from roles array
            raciData.roles = raciData.roles.filter(r => r !== role);

            // Remove role assignments from all tasks
            raciData.tasks.forEach(task => {
                delete task.assignments[role];
            });

            renderRolesList();
            renderTable();
            CleansheetCore.utils.showToast('Role deleted', 'success');
        }

        function toggleRaciVisibility() {
            rolesVisible = !rolesVisible;
            const table = document.getElementById('raciTable');
            const toggleBtn = document.getElementById('raciToggle');

            if (rolesVisible) {
                table.classList.remove('hide-roles');
                if (toggleBtn) {
                    toggleBtn.classList.add('active');
                    toggleBtn.innerHTML = '<i class="ph ph-eye"></i> Show RACI';
                }
            } else {
                table.classList.add('hide-roles');
                if (toggleBtn) {
                    toggleBtn.classList.remove('active');
                    toggleBtn.innerHTML = '<i class="ph ph-eye-slash"></i> Show RACI';
                }
            }
        }

        function toggleRaciVisibilityFromButton() {
            toggleRaciVisibility();
            const message = rolesVisible ? 'RACI columns shown' : 'RACI columns hidden';
            CleansheetCore.utils.showToast(message, 'success');
        }

        function clearAll() {
            if (!confirm('Are you sure you want to clear all data? This cannot be undone.')) return;

            raciData = {
                projectName: 'Untitled Project',
                roles: [],
                phases: [],
                tasks: []
            };
            renderTable();
            CleansheetCore.utils.showToast('All data cleared', 'success');
        }

        // Toggle Data Menu
        function toggleDataMenu() {
            const menu = document.getElementById('dataMenu');
            menu.classList.toggle('show');
        }

        // Close data menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dataMenu');
            const dataMenuButton = event.target.closest('.data-menu');

            if (!dataMenuButton && menu && menu.classList.contains('show')) {
                menu.classList.remove('show');
            }
        });

        // Export JSON
        function exportJSON() {
            const dataStr = JSON.stringify(raciData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;

            // Create filename from project name (sanitized) and date
            const sanitizedName = (raciData.projectName || 'Untitled Project')
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
            const dateStr = new Date().toISOString().split('T')[0];
            a.download = `${sanitizedName}-${dateStr}.json`;

            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            CleansheetCore.utils.showToast('Exported to JSON successfully', 'success');
        }

        // Export CSV
        function exportCSV() {
            // Build CSV content
            let csv = '';

            // Header row: Task, Phase, Start Date, End Date, Definition of Done, [Roles...]
            const headers = ['Task', 'Phase', 'Start Date', 'End Date', 'Definition of Done'];
            raciData.roles.forEach(role => headers.push(role));
            csv += headers.map(h => `"${h}"`).join(',') + '\n';

            // Data rows
            raciData.tasks.forEach(task => {
                const row = [];

                // Task name
                row.push(`"${(task.name || '').replace(/"/g, '""')}"`);

                // Phase name
                const phase = raciData.phases.find(p => p.id === task.phaseId);
                row.push(`"${phase ? phase.name.replace(/"/g, '""') : 'Unassigned'}"`);

                // Dates
                row.push(`"${task.startDate || ''}"`);
                row.push(`"${task.endDate || ''}"`);

                // Definition of Done
                row.push(`"${(task.definitionOfDone || '').replace(/"/g, '""')}"`);

                // Role assignments
                raciData.roles.forEach(role => {
                    const assignment = task.assignments && task.assignments[role] ? task.assignments[role] : '';
                    row.push(`"${assignment}"`);
                });

                csv += row.join(',') + '\n';
            });

            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;

            // Create filename from project name (sanitized) and date
            const sanitizedName = (raciData.projectName || 'Untitled Project')
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
            const dateStr = new Date().toISOString().split('T')[0];
            a.download = `${sanitizedName}-${dateStr}.csv`;

            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            CleansheetCore.utils.showToast('Exported to CSV successfully', 'success');
        }

        // Import JSON
        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);

                    // Validate structure
                    if (!imported.roles || !imported.tasks || !Array.isArray(imported.roles) || !Array.isArray(imported.tasks)) {
                        throw new Error('Invalid project data structure');
                    }

                    // Ensure project name exists (backward compatibility)
                    if (!imported.projectName) {
                        imported.projectName = 'Untitled Project';
                    }

                    // Ensure phases array exists (backward compatibility)
                    if (!imported.phases) {
                        imported.phases = [];
                    }

                    // Ensure all tasks have phaseId property
                    imported.tasks.forEach(task => {
                        if (task.phaseId === undefined) {
                            task.phaseId = null;
                        }
                    });

                    raciData = imported;
                    renderTable();
                    CleansheetCore.utils.showToast('Imported successfully', 'success');
                } catch (error) {
                    CleansheetCore.utils.showToast('Import failed: Invalid JSON format', 'error');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);

            // Reset input
            event.target.value = '';
        }

        // LocalStorage
        function saveToLocalStorage() {
            localStorage.setItem('cleansheet-project-planner', JSON.stringify(raciData));
        }

        function loadFromLocalStorage() {
            const stored = localStorage.getItem('cleansheet-project-planner');
            if (stored) {
                try {
                    const loadedData = JSON.parse(stored);

                    // Ensure project name exists (backward compatibility)
                    if (!loadedData.projectName) {
                        loadedData.projectName = 'Untitled Project';
                    }

                    // Ensure phases array exists (backward compatibility)
                    if (!loadedData.phases) {
                        loadedData.phases = [];
                    }

                    // Ensure all tasks have phaseId property
                    if (loadedData.tasks) {
                        loadedData.tasks.forEach(task => {
                            if (task.phaseId === undefined) {
                                task.phaseId = null;
                            }
                        });
                    }

                    raciData = loadedData;
                } catch (error) {
                    console.error('Failed to load from localStorage:', error);
                }
            }
        }

        // Example Templates
        const exampleTemplates = {
            'event-plan': {
                projectName: 'Corporate Event Plan',
                roles: ['Event Manager', 'Venue Coordinator', 'Marketing Lead', 'Finance Director'],
                phases: [
                    { id: 'phase-1', name: 'Planning & Preparation', collapsed: false },
                    { id: 'phase-2', name: 'Execution & Follow-up', collapsed: false }
                ],
                tasks: [
                    {
                        id: 'task-1',
                        name: 'Define event objectives and success metrics',
                        phaseId: 'phase-1',
                        assignments: {
                            'Event Manager': 'A',
                            'Venue Coordinator': 'C',
                            'Marketing Lead': 'C',
                            'Finance Director': 'R'
                        }
                    },
                    {
                        id: 'task-2',
                        name: 'Establish budget and funding approval',
                        phaseId: 'phase-1',
                        assignments: {
                            'Event Manager': 'C',
                            'Venue Coordinator': 'I',
                            'Marketing Lead': 'I',
                            'Finance Director': 'A'
                        }
                    },
                    {
                        id: 'task-3',
                        name: 'Research and shortlist venues',
                        phaseId: 'phase-1',
                        assignments: {
                            'Event Manager': 'C',
                            'Venue Coordinator': 'R',
                            'Marketing Lead': 'I',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-4',
                        name: 'Negotiate contracts and book venue',
                        phaseId: 'phase-1',
                        assignments: {
                            'Event Manager': 'A',
                            'Venue Coordinator': 'R',
                            'Marketing Lead': 'I',
                            'Finance Director': 'C'
                        }
                    },
                    {
                        id: 'task-5',
                        name: 'Create event branding and visual identity',
                        phaseId: 'phase-1',
                        assignments: {
                            'Event Manager': 'C',
                            'Venue Coordinator': 'I',
                            'Marketing Lead': 'R',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-6',
                        name: 'Develop promotional campaign and materials',
                        phaseId: 'phase-1',
                        assignments: {
                            'Event Manager': 'C',
                            'Venue Coordinator': 'I',
                            'Marketing Lead': 'A',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-7',
                        name: 'Manage attendee registration system',
                        phaseId: 'phase-1',
                        assignments: {
                            'Event Manager': 'A',
                            'Venue Coordinator': 'C',
                            'Marketing Lead': 'R',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-8',
                        name: 'Arrange catering and beverage services',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'C',
                            'Venue Coordinator': 'R',
                            'Marketing Lead': 'I',
                            'Finance Director': 'C'
                        }
                    },
                    {
                        id: 'task-9',
                        name: 'Coordinate AV equipment and tech setup',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'A',
                            'Venue Coordinator': 'R',
                            'Marketing Lead': 'I',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-10',
                        name: 'Brief staff and volunteers on roles',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'R',
                            'Venue Coordinator': 'C',
                            'Marketing Lead': 'C',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-11',
                        name: 'Execute event day operations',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'A',
                            'Venue Coordinator': 'R',
                            'Marketing Lead': 'R',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-12',
                        name: 'Monitor social media during event',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'I',
                            'Venue Coordinator': 'I',
                            'Marketing Lead': 'R',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-13',
                        name: 'Manage post-event venue breakdown',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'C',
                            'Venue Coordinator': 'R',
                            'Marketing Lead': 'I',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-14',
                        name: 'Gather attendee feedback and surveys',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'R',
                            'Venue Coordinator': 'I',
                            'Marketing Lead': 'C',
                            'Finance Director': 'I'
                        }
                    },
                    {
                        id: 'task-15',
                        name: 'Process final invoices and payments',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'C',
                            'Venue Coordinator': 'C',
                            'Marketing Lead': 'I',
                            'Finance Director': 'R'
                        }
                    },
                    {
                        id: 'task-16',
                        name: 'Prepare event summary report',
                        phaseId: 'phase-2',
                        assignments: {
                            'Event Manager': 'A',
                            'Venue Coordinator': 'C',
                            'Marketing Lead': 'C',
                            'Finance Director': 'C'
                        }
                    }
                ]
            },
            'software-release': {
                projectName: 'Software Release v2.0',
                roles: ['Product Manager', 'Lead Developer', 'QA Engineer', 'DevOps Engineer', 'Support Lead'],
                phases: [
                    { id: 'phase-1', name: 'Development', collapsed: false },
                    { id: 'phase-2', name: 'Testing & Deployment', collapsed: false },
                    { id: 'phase-3', name: 'Release & Monitoring', collapsed: false }
                ],
                tasks: [
                    {
                        id: 'task-1',
                        name: 'Define release scope and requirements',
                        phaseId: 'phase-1',
                        assignments: {
                            'Product Manager': 'A',
                            'Lead Developer': 'C',
                            'QA Engineer': 'C',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'C'
                        }
                    },
                    {
                        id: 'task-2',
                        name: 'Create technical architecture design',
                        phaseId: 'phase-1',
                        assignments: {
                            'Product Manager': 'C',
                            'Lead Developer': 'A',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'C',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-3',
                        name: 'Develop new features and enhancements',
                        phaseId: 'phase-1',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'R',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-4',
                        name: 'Write unit tests and integration tests',
                        phaseId: 'phase-1',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'R',
                            'QA Engineer': 'C',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-5',
                        name: 'Conduct code reviews and merge PRs',
                        phaseId: 'phase-1',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'A',
                            'QA Engineer': 'C',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-6',
                        name: 'Update API documentation',
                        phaseId: 'phase-1',
                        assignments: {
                            'Product Manager': 'C',
                            'Lead Developer': 'R',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'C'
                        }
                    },
                    {
                        id: 'task-7',
                        name: 'Create comprehensive test plan',
                        phaseId: 'phase-2',
                        assignments: {
                            'Product Manager': 'C',
                            'Lead Developer': 'C',
                            'QA Engineer': 'A',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-8',
                        name: 'Execute functional testing',
                        phaseId: 'phase-2',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'C',
                            'QA Engineer': 'R',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-9',
                        name: 'Perform regression and smoke testing',
                        phaseId: 'phase-2',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'C',
                            'QA Engineer': 'R',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-10',
                        name: 'Configure CI/CD pipeline',
                        phaseId: 'phase-2',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'C',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'R',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-11',
                        name: 'Deploy to staging environment',
                        phaseId: 'phase-2',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'C',
                            'QA Engineer': 'C',
                            'DevOps Engineer': 'R',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-12',
                        name: 'Validate staging deployment',
                        phaseId: 'phase-2',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'C',
                            'QA Engineer': 'A',
                            'DevOps Engineer': 'C',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-13',
                        name: 'Create release notes and changelog',
                        phaseId: 'phase-3',
                        assignments: {
                            'Product Manager': 'A',
                            'Lead Developer': 'C',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'C'
                        }
                    },
                    {
                        id: 'task-14',
                        name: 'Deploy to production environment',
                        phaseId: 'phase-3',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'C',
                            'QA Engineer': 'C',
                            'DevOps Engineer': 'A',
                            'Support Lead': 'I'
                        }
                    },
                    {
                        id: 'task-15',
                        name: 'Monitor system health and performance',
                        phaseId: 'phase-3',
                        assignments: {
                            'Product Manager': 'I',
                            'Lead Developer': 'C',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'R',
                            'Support Lead': 'C'
                        }
                    },
                    {
                        id: 'task-16',
                        name: 'Prepare customer support documentation',
                        phaseId: 'phase-3',
                        assignments: {
                            'Product Manager': 'C',
                            'Lead Developer': 'C',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'A'
                        }
                    },
                    {
                        id: 'task-17',
                        name: 'Train support team on new features',
                        phaseId: 'phase-3',
                        assignments: {
                            'Product Manager': 'R',
                            'Lead Developer': 'C',
                            'QA Engineer': 'I',
                            'DevOps Engineer': 'I',
                            'Support Lead': 'C'
                        }
                    },
                    {
                        id: 'task-18',
                        name: 'Conduct post-release retrospective',
                        phaseId: 'phase-3',
                        assignments: {
                            'Product Manager': 'A',
                            'Lead Developer': 'R',
                            'QA Engineer': 'R',
                            'DevOps Engineer': 'R',
                            'Support Lead': 'R'
                        }
                    }
                ]
            },
            'marketing-launch': {
                projectName: 'Product Marketing Launch',
                roles: ['Marketing Director', 'Content Manager', 'Social Media Manager', 'Graphic Designer', 'Analytics Lead'],
                phases: [
                    { id: 'phase-1', name: 'Strategy & Planning', collapsed: false },
                    { id: 'phase-2', name: 'Content Creation', collapsed: false },
                    { id: 'phase-3', name: 'Launch & Optimization', collapsed: false }
                ],
                tasks: [
                    {
                        id: 'task-1',
                        name: 'Define campaign goals and KPIs',
                        phaseId: 'phase-1',
                        assignments: {
                            'Marketing Director': 'A',
                            'Content Manager': 'C',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'R'
                        }
                    },
                    {
                        id: 'task-2',
                        name: 'Conduct target audience research',
                        phaseId: 'phase-1',
                        assignments: {
                            'Marketing Director': 'C',
                            'Content Manager': 'C',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'R'
                        }
                    },
                    {
                        id: 'task-3',
                        name: 'Develop content strategy and calendar',
                        phaseId: 'phase-1',
                        assignments: {
                            'Marketing Director': 'A',
                            'Content Manager': 'R',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-4',
                        name: 'Create campaign messaging framework',
                        phaseId: 'phase-1',
                        assignments: {
                            'Marketing Director': 'C',
                            'Content Manager': 'R',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-5',
                        name: 'Allocate budget across channels',
                        phaseId: 'phase-1',
                        assignments: {
                            'Marketing Director': 'A',
                            'Content Manager': 'I',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'C'
                        }
                    },
                    {
                        id: 'task-6',
                        name: 'Design brand visual identity',
                        phaseId: 'phase-2',
                        assignments: {
                            'Marketing Director': 'C',
                            'Content Manager': 'C',
                            'Social Media Manager': 'I',
                            'Graphic Designer': 'R',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-7',
                        name: 'Create social media graphics and templates',
                        phaseId: 'phase-2',
                        assignments: {
                            'Marketing Director': 'I',
                            'Content Manager': 'C',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'R',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-8',
                        name: 'Write blog posts and articles',
                        phaseId: 'phase-2',
                        assignments: {
                            'Marketing Director': 'C',
                            'Content Manager': 'R',
                            'Social Media Manager': 'I',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-9',
                        name: 'Develop email marketing campaigns',
                        phaseId: 'phase-2',
                        assignments: {
                            'Marketing Director': 'C',
                            'Content Manager': 'R',
                            'Social Media Manager': 'I',
                            'Graphic Designer': 'C',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-10',
                        name: 'Produce video content and animations',
                        phaseId: 'phase-2',
                        assignments: {
                            'Marketing Director': 'I',
                            'Content Manager': 'C',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'A',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-11',
                        name: 'Review and approve all content',
                        phaseId: 'phase-2',
                        assignments: {
                            'Marketing Director': 'A',
                            'Content Manager': 'R',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'C',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-12',
                        name: 'Set up tracking and analytics tools',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'I',
                            'Content Manager': 'I',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'R'
                        }
                    },
                    {
                        id: 'task-13',
                        name: 'Schedule and publish initial content',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'I',
                            'Content Manager': 'C',
                            'Social Media Manager': 'R',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-14',
                        name: 'Launch paid advertising campaigns',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'A',
                            'Content Manager': 'I',
                            'Social Media Manager': 'R',
                            'Graphic Designer': 'C',
                            'Analytics Lead': 'C'
                        }
                    },
                    {
                        id: 'task-15',
                        name: 'Monitor real-time engagement metrics',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'I',
                            'Content Manager': 'I',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'R'
                        }
                    },
                    {
                        id: 'task-16',
                        name: 'Respond to customer inquiries and comments',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'I',
                            'Content Manager': 'C',
                            'Social Media Manager': 'R',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'I'
                        }
                    },
                    {
                        id: 'task-17',
                        name: 'Analyze campaign performance data',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'C',
                            'Content Manager': 'I',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'A'
                        }
                    },
                    {
                        id: 'task-18',
                        name: 'Optimize content based on insights',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'A',
                            'Content Manager': 'R',
                            'Social Media Manager': 'R',
                            'Graphic Designer': 'C',
                            'Analytics Lead': 'C'
                        }
                    },
                    {
                        id: 'task-19',
                        name: 'Generate campaign performance report',
                        phaseId: 'phase-3',
                        assignments: {
                            'Marketing Director': 'C',
                            'Content Manager': 'I',
                            'Social Media Manager': 'C',
                            'Graphic Designer': 'I',
                            'Analytics Lead': 'R'
                        }
                    }
                ]
            }
        };

        // Toggle Examples Panel
        function toggleExamplesPanel() {
            const panel = document.getElementById('examplesPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        // Load Example
        function loadExample(templateName) {
            // Warn if there is existing data
            if (raciData.tasks.length > 0 || raciData.phases.length > 0) {
                const confirmLoad = confirm(
                    'Loading this example will replace all existing data.\n\nAre you sure you want to continue?'
                );
                if (!confirmLoad) return;
            }

            try {
                const template = exampleTemplates[templateName];
                if (!template) {
                    throw new Error('Example template not found');
                }

                // Load the template data
                raciData = {
                    roles: [...template.roles],
                    phases: template.phases.map(p => ({ ...p, id: generateId() })),
                    tasks: []
                };

                // Create phase ID mapping
                const phaseIdMap = {};
                template.phases.forEach((oldPhase, index) => {
                    phaseIdMap[oldPhase.id] = raciData.phases[index].id;
                });

                // Copy tasks with new IDs and mapped phase IDs
                raciData.tasks = template.tasks.map(task => ({
                    id: generateId(),
                    name: task.name,
                    phaseId: phaseIdMap[task.phaseId] || null,
                    assignments: { ...task.assignments }
                }));

                // Hide examples panel
                document.getElementById('examplesPanel').style.display = 'none';

                // Save and render
                saveToLocalStorage();
                renderTable();
                CleansheetCore.utils.showToast(`Loaded ${templateName.replace('-', ' ')} example`, 'success');
            } catch (error) {
                CleansheetCore.utils.showToast('Error loading example: ' + error.message, 'error');
                console.error('Load example error:', error);
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
