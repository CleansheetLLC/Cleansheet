<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Canvas - Refactored Test</title>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f7;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a1a1a;
            margin-top: 0;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f8f8;
            border-radius: 8px;
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #004c99;
        }
        #results {
            margin-top: 20px;
        }
        .file-list {
            background: white;
            padding: 15px;
            border-radius: 6px;
            max-height: 300px;
            overflow-y: auto;
        }
        .file-item {
            padding: 5px 10px;
            margin: 2px 0;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }
        .file-item.exists {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .file-item.missing {
            background: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Career Canvas - Refactored Structure Test</h1>

        <div class="section">
            <h2>Test Suite</h2>
            <p>This page tests the refactored Career Canvas structure to ensure all modules are properly extracted and functional.</p>

            <button onclick="testFileStructure()">Test File Structure</button>
            <button onclick="testCSSLoading()">Test CSS Loading</button>
            <button onclick="testModuleLoading()">Test Module Loading</button>
            <button onclick="testPersonaLoading()">Test Persona Loading</button>
            <button onclick="openRefactoredCanvas()">Open Refactored Canvas</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');

        function addResult(message, type = 'info') {
            const result = document.createElement('div');
            result.className = `status ${type}`;
            result.textContent = message;
            resultsDiv.appendChild(result);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        async function testFileStructure() {
            clearResults();
            addResult('Testing file structure...', 'info');

            const files = [
                // CSS files
                'career-canvas/css/career-canvas-main.css',
                'career-canvas/css/career-canvas-base.css',
                'career-canvas/css/career-canvas-layout.css',
                'career-canvas/css/career-canvas-components.css',
                'career-canvas/css/career-canvas-modals.css',
                'career-canvas/css/career-canvas-animations.css',

                // JavaScript core files
                'career-canvas/js/core/career-canvas-init.js',
                'career-canvas/js/core/career-canvas-config.js',
                'career-canvas/js/core/career-canvas-utils.js',
                'career-canvas/js/core/career-canvas-state.js',

                // Vendor files
                'career-canvas/js/vendor/latex-parser.js',

                // Data files
                'career-canvas/data/personas/career_changer.js',
                'career-canvas/data/personas/product_manager.js',
                'career-canvas/data/personas/new_graduate.js',

                // Main HTML file
                'career-canvas/index.html'
            ];

            const fileList = document.createElement('div');
            fileList.className = 'file-list';
            resultsDiv.appendChild(fileList);

            let existingCount = 0;
            let missingCount = 0;

            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';

                    if (response.ok) {
                        fileItem.classList.add('exists');
                        fileItem.textContent = `✓ ${file}`;
                        existingCount++;
                    } else {
                        fileItem.classList.add('missing');
                        fileItem.textContent = `✗ ${file} (${response.status})`;
                        missingCount++;
                    }

                    fileList.appendChild(fileItem);
                } catch (error) {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item missing';
                    fileItem.textContent = `✗ ${file} (Error: ${error.message})`;
                    fileList.appendChild(fileItem);
                    missingCount++;
                }
            }

            if (missingCount === 0) {
                addResult(`✓ All ${existingCount} files exist!`, 'success');
            } else {
                addResult(`⚠ ${existingCount} files exist, ${missingCount} files missing`, 'warning');
            }
        }

        async function testCSSLoading() {
            clearResults();
            addResult('Testing CSS loading...', 'info');

            try {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'career-canvas/css/career-canvas-main.css';

                link.onload = () => {
                    addResult('✓ Main CSS loaded successfully', 'success');

                    // Check if CSS variables are available
                    const testDiv = document.createElement('div');
                    testDiv.style.cssText = 'color: var(--color-primary-blue)';
                    document.body.appendChild(testDiv);

                    const computedStyle = window.getComputedStyle(testDiv);
                    const color = computedStyle.color;

                    document.body.removeChild(testDiv);

                    if (color !== 'rgba(0, 0, 0, 0)' && color !== '') {
                        addResult('✓ CSS variables are working', 'success');
                    } else {
                        addResult('⚠ CSS variables may not be loaded', 'warning');
                    }
                };

                link.onerror = () => {
                    addResult('✗ Failed to load main CSS', 'error');
                };

                document.head.appendChild(link);
            } catch (error) {
                addResult(`✗ CSS test failed: ${error.message}`, 'error');
            }
        }

        async function testModuleLoading() {
            clearResults();
            addResult('Testing module loading...', 'info');

            // Test module loader
            const script = document.createElement('script');
            script.textContent = `
                window.CareerCanvas = {
                    modules: {},
                    loadedModules: new Set(),

                    async loadModule(moduleName) {
                        return new Promise((resolve, reject) => {
                            const script = document.createElement('script');
                            script.src = 'career-canvas/js/' + moduleName + '.js';

                            script.onload = () => {
                                this.loadedModules.add(moduleName);
                                resolve(this.modules[moduleName.split('/').pop().replace('career-canvas-', '')]);
                            };

                            script.onerror = () => {
                                reject(new Error('Failed to load module: ' + moduleName));
                            };

                            document.head.appendChild(script);
                        });
                    }
                };
            `;
            document.head.appendChild(script);

            try {
                // Try loading core modules
                const modules = ['core/career-canvas-config', 'core/career-canvas-utils', 'core/career-canvas-state'];

                for (const module of modules) {
                    try {
                        await window.CareerCanvas.loadModule(module);
                        addResult(`✓ Loaded module: ${module}`, 'success');
                    } catch (error) {
                        addResult(`✗ Failed to load ${module}: ${error.message}`, 'error');
                    }
                }

                // Check if modules are registered
                const registeredModules = Object.keys(window.CareerCanvas.modules);
                if (registeredModules.length > 0) {
                    addResult(`✓ ${registeredModules.length} modules registered: ${registeredModules.join(', ')}`, 'success');
                } else {
                    addResult('⚠ No modules registered', 'warning');
                }
            } catch (error) {
                addResult(`✗ Module test failed: ${error.message}`, 'error');
            }
        }

        async function testPersonaLoading() {
            clearResults();
            addResult('Testing persona loading...', 'info');

            const personas = ['career_changer', 'product_manager', 'new_graduate'];

            for (const persona of personas) {
                try {
                    const response = await fetch(`career-canvas/data/personas/${persona}.js`);
                    if (response.ok) {
                        const text = await response.text();
                        addResult(`✓ Loaded persona: ${persona} (${text.length} bytes)`, 'success');

                        // Check if it's valid JavaScript
                        if (text.includes('export default') || text.includes('const')) {
                            addResult(`  ✓ Valid JavaScript structure for ${persona}`, 'success');
                        } else {
                            addResult(`  ⚠ Persona ${persona} may have structural issues`, 'warning');
                        }
                    } else {
                        addResult(`✗ Failed to load persona: ${persona}`, 'error');
                    }
                } catch (error) {
                    addResult(`✗ Error loading persona ${persona}: ${error.message}`, 'error');
                }
            }
        }

        function openRefactoredCanvas() {
            clearResults();
            addResult('Opening refactored Career Canvas...', 'info');
            window.open('career-canvas/index.html', '_blank');
            addResult('✓ Opened Career Canvas in new tab', 'success');
        }

        // Run initial test
        window.addEventListener('DOMContentLoaded', () => {
            addResult('Test page loaded. Click the buttons above to run tests.', 'info');
        });
    </script>
</body>
</html>